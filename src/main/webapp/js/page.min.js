var Page=function(e){this.currentCommentId="",this.tips=e};$.extend(Page.prototype,{insertEmotions:function(e){var t=this;void 0===e&&(e=""),$("#emotions"+e+" span").click(function(){var a=$("#comment"+e),s=t._getCursorEndPosition(a[0]),i=this.title+" ",r=a[0].value;if(r=r.substring(0,s)+i+r.substring(s,r.length),$("#comment"+e).val(r),$.browser.msie){s-=r.split("\n").length-1;var l=a[0].createTextRange();l.collapse(!0),l.moveStart("character",s+i.length),l.select()}else a[0].setSelectionRange(s+i.length,s+i.length)})},_getCursorEndPosition:function(e){if(e.focus(),e.setSelectionRange)return e.selectionEnd;if(document.selection){var t=0,a=document.selection.createRange(),s=document.body.createTextRange();for(s.moveToElementText(e),a.getBookmark(),t=0;s.compareEndPoints("StartToStart",a)<0&&0!==a.moveStart("character",-1);t++)"\n"===e.value.charAt(t)&&t++;return t}},validateComment:function(e){if(Util.isLoggedIn()){var t=$("#comment"+e).val().replace(/(^\s*)|(\s*$)/g,"");return!(2>t.length||t.length>500)||($("#commentErrorTip"+e).html(this.tips.commentContentCannotEmptyLabel),$("#comment"+e).focus(),$("#commentErrorTip"+e).show(),!1)}var a=$("#commentName"+e).val().replace(/(^\s*)|(\s*$)/g,""),t=$("#comment"+e).val().replace(/(^\s*)|(\s*$)/g,"");if(2>a.length||a.length>20)$("#commentErrorTip"+e).html(this.tips.nameTooLongLabel),$("#commentName"+e).focus();else if(""===$("#commentEmail"+e).val().replace(/\s/g,""))$("#commentErrorTip"+e).html(this.tips.mailCannotEmptyLabel),$("#commentEmail"+e).focus();else if(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test($("#commentEmail"+e).val()))if(2>t.length||t.length>500)$("#commentErrorTip"+e).html(this.tips.commentContentCannotEmptyLabel),$("#comment"+e).focus();else{if(""!==$("#commentValidate"+e).val().replace(/\s/g,""))return!0;$("#commentErrorTip"+e).html(this.tips.captchaCannotEmptyLabel),$("#commentValidate"+e).focus()}else $("#commentErrorTip"+e).html(this.tips.mailInvalidLabel),$("#commentEmail"+e).focus();return $("#commentErrorTip"+e).show(),!1},replaceCommentsEm:function(e){for(var t=$(e),a=0;a<t.length;a++){var s=t[a].innerHTML;t[a].innerHTML=Util.replaceEmString(s)}},_initSyntaxHighlighter:function(e){for(var t=0;t<e.length;t++)switch(e[t]){case"groovy":e[t]="groovy\t\t\t\t"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushGroovy.js";break;case"java":e[t]="java\t\t\t\t"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushJava.js";break;case"php":e[t]="php\t\t\t\t"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushPhp.js";break;case"scala":e[t]="scala\t\t\t\t"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushScala.js";break;case"sql":e[t]="sql\t\t\t\t"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushSql.js";break;case"applescript":e[t]="applescript\t\t\t"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushAppleScript.js";break;case"as3":case"actionscript3":e[t]="actionscript3 as3                  "+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushAS3.js";break;case"bash":case"shell":e[t]="bash shell                         "+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushBash.js";break;case"coldfusion":case"cf":e[t]="coldfusion cf\t\t\t"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushColdFusion.js";break;case"c#":case"c-sharp":case"csharp":e[t]="c# c-sharp csharp                  "+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushCSharp.js";break;case"cpp":case"c":e[t]="cpp c\t\t\t\t"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushCpp.js";break;case"css":e[t]="css\t\t\t\t"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushCss.js";break;case"delphi":case"pascal":e[t]="delphi pascal\t\t\t"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushDelphi.js";break;case"diff":case"patch":case"pas":e[t]="diff patch pas\t\t\t"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushDiff.js";break;case"erl":case"erlang":e[t]="erl erlang                         "+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushErlang.js";break;case"js":case"jscript":case"javascript":e[t]="js jscript javascript              "+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushJScript.js";break;case"jfx":case"javafx":e[t]="jfx javafx                 \t"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushJavaFX.js";break;case"perl":case"pl":e[t]="perl pl                    \t"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushPerl.js";break;case"plain":case"text":e[t]="text plain                 \t"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushPlain.js";break;case"ps":case"powershell":e[t]="ps powershell                      "+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushPowerShell.js";break;case"py":case"python":e[t]="py python                          "+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushPython.js";break;case"rails":case"ror":case"ruby":case"rb":e[t]="ruby rails ror rb          \t"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushRuby.js";break;case"sass":case"scss":e[t]="sass scss                  \t"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushSass.js";break;case"vb":case"vbnet":e[t]="vb vbnet                   \t"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushVb.js";break;case"xml":case"xhtml":case"xslt":case"html":e[t]="xml xhtml xslt html                "+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushXml.js"}SyntaxHighlighter.autoloader.apply(null,e),SyntaxHighlighter.config.stripBrs=!0,SyntaxHighlighter.all()},_loadSyntaxHighlighter:function(e){var t=e||"shCoreEclipse",a=this;document.createStyleSheet?document.createStyleSheet(latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/styles/"+t+".css"):$("head").append($("<link rel='stylesheet' href='"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/styles/"+t+".css' type='text/css' charset='utf-8' />")),$.ajax({url:latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shCore.js",dataType:"script",cache:!0,success:function(){var e=[],t=!1;$(".article-body pre, .code-highlight pre").each(function(){var a=this.className.split(";")[0],s=a.substr(7,a.length-1);this.className.indexOf("html-script: true")>-1&&"xml"!==s&&"xhtml"!==s&&"xslt"!==s&&"html"!=s&&(t=!0),e.push(s)}),t?$.ajax({url:latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushXml.js",dataType:"script",cache:!0,success:function(){a._initSyntaxHighlighter(e)}}):a._initSyntaxHighlighter(e)}})},parseLanguage:function(e){var t=!1,a=!1;return $(".article-body pre, .code-highlight pre").each(function(){this.className.indexOf("brush")>-1&&(a=!0),this.className.indexOf("prettyprint")>-1&&(t=!0)}),a?(this._loadSyntaxHighlighter(e&&e.SHTheme?e.SHTheme:void 0),!1):t?(document.createStyleSheet?document.createStyleSheet(latkeConfig.staticServePath+"/js/lib/google-code-prettify/prettify.css"):$("head").append($("<link rel='stylesheet' href='"+latkeConfig.staticServePath+"/js/lib/google-code-prettify/prettify.css'>")),$.ajax({url:latkeConfig.staticServePath+"/js/lib/google-code-prettify/prettify.js",dataType:"script",cache:!0,success:function(){prettyPrint()}}),!1):(document.createStyleSheet?document.createStyleSheet(latkeConfig.staticServePath+"/js/lib/highlight.js-9.6.0/styles/default.css"):$("head").append($("<link rel='stylesheet' href='"+latkeConfig.staticServePath+"/js/lib/highlight.js-9.6.0/styles/github.css'>")),void $.ajax({url:latkeConfig.staticServePath+"/js/lib/highlight.js-9.6.0/highlight.pack.js",dataType:"script",cache:!0,success:function(){hljs.initHighlighting.called=!1,hljs.initHighlighting()}}))},load:function(e){var t=this;t.insertEmotions(),t.parseLanguage(e&&e.language?e.language:void 0),$("#commentValidate").keypress(function(e){13===e.keyCode&&t.submitComment()}),$("#comment").keypress(function(e){13===e.keyCode&&e.ctrlKey&&t.submitComment()}),$("#captcha").click(function(){$(this).attr("src",latkeConfig.servePath+"/captcha.do?code="+Math.random())}),Util.isLoggedIn()||($("#commentEmail").val(Cookie.readCookie("commentEmail")),$("#commentURL").val(Cookie.readCookie("commentURL")),$("#commentName").val(Cookie.readCookie("commentName")));try{JSON}catch(e){document.write('<script src="'+latkeConfig.staticServePath+'/js/lib/json2.js"><\/script>')}},loadRandomArticles:function(e){var t=this.tips.randomArticles1Label;$.ajax({url:latkeConfig.servePath+"/get-random-articles.do",type:"POST",success:function(a,s){var i=a.randomArticles;if(!i||0===i.length)return void $("#randomArticles").remove();for(var r="",l=0;l<i.length;l++){var c=i[l],n=c.articleTitle;r+="<li><a rel='nofollow' title='"+n+"' href='"+latkeConfig.servePath+c.articlePermalink+"'>"+n+"</a></li>"}var o=e||"<h4>"+t+"</h4>",m=o+"<ul class='marginLeft12'>"+r+"</ul>";$("#randomArticles").append(m)}})},loadRelevantArticles:function(e,t){$.ajax({url:latkeConfig.servePath+"/article/id/"+e+"/relevant/articles",type:"GET",success:function(e,a){var s=e.relevantArticles;if(!s||0===s.length)return void $("#relevantArticles").remove();for(var i="",r=0;r<s.length;r++){var l=s[r],c=l.articleTitle;i+="<li><a rel='nofollow' title='"+c+"' href='"+latkeConfig.servePath+l.articlePermalink+"'>"+c+"</a></li>"}var n=t+"<ul class='marginLeft12'>"+i+"</ul>";$("#relevantArticles").append(n)},error:function(){$("#relevantArticles").remove()}})},loadExternalRelevantArticles:function(e,t){},submitComment:function(e,t){t||(t="");var a=this,s=this.tips,i="article";if(void 0===s.externalRelevantArticlesDisplayCount&&(i="page"),this.validateComment(t)){$("#submitCommentButton"+t).attr("disabled","disabled"),$("#commentErrorTip"+t).show().html(this.tips.loadingLabel);var r={oId:s.oId,commentContent:$("#comment"+t).val().replace(/(^\s*)|(\s*$)/g,"")};Util.isLoggedIn()||(r={oId:s.oId,commentContent:$("#comment"+t).val().replace(/(^\s*)|(\s*$)/g,""),commentEmail:$("#commentEmail"+t).val(),commentURL:Util.proessURL($("#commentURL"+t).val().replace(/(^\s*)|(\s*$)/g,"")),commentName:$("#commentName"+t).val().replace(/(^\s*)|(\s*$)/g,""),captcha:$("#commentValidate"+t).val()},Cookie.createCookie("commentName",r.commentName,365),Cookie.createCookie("commentEmail",r.commentEmail,365),Cookie.createCookie("commentURL",$("#commentURL"+t).val().replace(/(^\s*)|(\s*$)/g,""),365)),"Reply"===t&&(r.commentOriginalCommentId=e),$.ajax({type:"POST",url:latkeConfig.servePath+"/add-"+i+"-comment.do",cache:!1,contentType:"application/json",data:JSON.stringify(r),success:function(e){if($("#submitCommentButton"+t).removeAttr("disabled"),!e.sc)return $("#commentErrorTip"+t).html(e.msg),$("#commentValidate"+t).val(""),$("#captcha"+t).click(),void(Util.isLoggedIn()||$("#captcha"+t).attr("src",latkeConfig.servePath+"/captcha.do?code="+Math.random()));$("#comment"+t).val(e.commentContent),$("#commentName"+t).val(e.commentName),e.replyNameHTML="",Util.isLoggedIn()?(e.replyNameHTML='<a href="'+window.location.host+'" target="_blank">'+Util.getUserName()+"</a>",e.userName=Util.getUserName()):($("#captcha"+t).attr("src",latkeConfig.servePath+"/captcha.do?code="+Math.random()),""===$("#commentURL"+t).val().replace(/\s/g,"")?e.replyNameHTML="<a>"+$("#commentName"+t).val()+"</a>":e.replyNameHTML='<a href="'+Util.proessURL($("#commentURL"+t).val())+'" target="_blank">'+$("#commentName"+t).val()+"</a>",e.userName=e.commentName),a.addCommentAjax(Util.replaceEmString(e.cmtTpl),t)}})}},addReplyForm:function(e,t,a){var s=this;if(e===this.currentCommentId)return void(""===$("#commentNameReply").val()?$("#commentNameReply").focus():""===$("#commentEmailReply").val()?$("#commentEmailReply").focus():$("#commentReply").focus());$("#replyForm").remove(),a=a||"","</div>"===a?$("#"+e).append(t+$("#commentForm").html()+a):$("#"+e).append(t+$("#commentForm").html()+"</table>"+a),$("#replyForm input, #replyForm textarea").each(function(){this.id=this.id+"Reply"}),$("#commentNameReply").val(Cookie.readCookie("commentName")),$("#commentEmailReply").val(Cookie.readCookie("commentEmail"));var i=$("#replyForm #commentURLLabel");1===i.length&&i.attr("id","commentURLLabelReply"),$("#commentURLReply").val(Cookie.readCookie("commentURL")),$("#replyForm #emotions").attr("id","emotionsReply"),this.insertEmotions("Reply"),$("#commentReply").unbind().keypress(function(t){13===t.keyCode&&t.ctrlKey&&(s.submitComment(e,"Reply"),t.preventDefault())}),$("#commentValidateReply").unbind().keypress(function(t){13===t.keyCode&&(s.submitComment(e,"Reply"),t.preventDefault())}),$("#replyForm #captcha").attr("id","captchaReply").attr("src",latkeConfig.servePath+"/captcha.do?"+(new Date).getTime()).click(function(){$(this).attr("src",latkeConfig.servePath+"/captcha.do?code="+Math.random())}),$("#replyForm #commentErrorTip").attr("id","commentErrorTipReply").html("").hide(),$("#replyForm #submitCommentButton").attr("id","submitCommentButtonReply"),$("#replyForm #submitCommentButtonReply").unbind("click").removeAttr("onclick").click(function(){s.submitComment(e,"Reply")}),""===$("#commentNameReply").val()?$("#commentNameReply").focus():""===$("#commentEmailReply").val()?$("#commentEmailReply").focus():$("#commentReply").focus(),this.currentCommentId=e},hideComment:function(e){$("#commentRef"+e).hide()},showComment:function(e,t,a,s){var i=parseInt($(e).position().top);if(s&&(i=parseInt($(e).parents(s).position().top)),$("#commentRef"+t).length>0)$("#commentRef"+t).show().css("top",i+a+"px");else{var r=$("#"+t).clone();r.addClass("comment-body-ref").attr("id","commentRef"+t),r.find("#replyForm").remove(),$("#comments").append(r),$("#commentRef"+t).css("top",i+a+"px")}},addCommentAjax:function(e,t){$("#comments").children().length>0?$($("#comments").children()[0]).before(e):$("#comments").html(e),""===t?($("#commentErrorTip").html("").hide(),$("#comment").val(""),$("#commentValidate").val(""),$("#captcha").attr("src",latkeConfig.servePath+"/captcha.do?code="+Math.random())):$("#replyForm").remove(),window.location.hash="#comments"}});